<link rel="stylesheet" href="./codemirror.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<!--<script src="/socket.io/socket.io.js"></script>-->
<script src="http://interactiveclassroom.herokuapp.com/socket.io/socket.io.js"></script>
<script src="./codemirror.js"></script>
<style type="text/css">
      .CodeMirror {border: 1px solid black;}
</style>
<script>
    //var socket = io.connect('http://localhost');
    var socket = io.connect();

    socket.on('connect', function () {
        console.log('Client: In connect!');
        socket.emit('requestChallenge');
      });
          
    socket.on('news', function (data) {
        console.log('Client: In news');
        console.log(data);
        socket.emit('my other event', { my: 'data' });
    });

</script>
<body>
    <h1 id="title"></h1>
    <textarea id="codeEditor">Write your code here!</textarea>
    <button id="submitButton" type="button">Submit</button><br>
    <textarea id="outputBox" rows="10" cols="50" disabled>Results</textarea>
</body>
<script>
    var inputs = {};
    var outputs = {};
    var functionName;
    var userFn;
    var editor = CodeMirror.fromTextArea(document.getElementById("codeEditor"), 
    {
        lineNumbers: true,
        mode: "javascript"
    });

    socket.on('sendChallenge', function (data) {
        console.log('Client: In send challenge');
        $("#title").html(data.problem);
        console.log("output = " + data.output.toString());
        inputs = data.input;
        outputs = data.output;
        functionName = data.functionName;
    });
    
    $('#submitButton').click(function()
    {
        $('#outputBox').val('Results');
        console.log(editor.getValue());
        console.log("output = " + outputs.toString());
        eval(editor.getValue());
        total = inputs.length;
        correct = 0.0;
        for(var i in inputs)
        {
            var output = eval(functionName+'(inputs[i])');
            if(output == outputs[i])
            {
                correct += 1.0;
                $('#outputBox').val($('#outputBox').val() + '\nTest ' + i + ' PASSED'); 
            }
            else 
            {
                $('#outputBox').val($('#outputBox').val() + '\nTest ' + i + ' FAILED'); 
                $('#outputBox').val($('#outputBox').val() + '\nInput: ' + inputs[i]);
                $('#outputBox').val($('#outputBox').val() + '\nYour output: ' + output);
                $('#outputBox').val($('#outputBox').val() + '\nCorrect output: ' + outputs[i]);
            }
        }
        message = '\n' + (100*correct/total) + '% Correct';
        $('#outputBox').val($('#outputBox').val() + message);
        console.log(message);
    });
  
/*
var findMax = function(numbArray)
    {
        var max = numbArray[0];
        for (var i = 0; i < numbArray.length; i++)
        {
            if (numbArray[i] > max) max = numbArray[i];
        }
        return max;
    }
*/
</script>