<link rel="stylesheet" href="./codemirror.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="./codemirror.js"></script>
<style type="text/css">
      .CodeMirror {border: 1px solid black;}
</style>
<script>
    var socket = io.connect('http://localhost');

    socket.on('connect', function () {
        console.log('Client: In connect!');
        socket.emit('requestChallenge');
      });
          
    socket.on('news', function (data) {
        console.log('Client: In news');
        console.log(data);
        socket.emit('my other event', { my: 'data' });
    });

</script>
<body>
    <textarea id="codeEditor">Write your code here!</textarea>
    <button id="submitButton" type="button">Submit</button><br>
    <textarea id="outputBox" disabled>Output Here</textarea>
</body>
<script>
    var inputs = {};
    var outputs = {};
    var functionName;
    var userFn;
    var editor = CodeMirror.fromTextArea(document.getElementById("codeEditor"), 
    {
        lineNumbers: true,
        mode: "javascript"
    });

    socket.on('sendChallenge', function (data) {
        console.log('Client: In send challenge');
        $("#outputBox").val(data.problem);
        console.log("output = " + data.output.toString());
        inputs = data.input;
        outputs = data.output;
        functionName = data.functionName;
    });
    
    $('#submitButton').click(function()
    {
        console.log(editor.getValue());
        console.log("output = " + outputs.toString());
        eval(editor.getValue());
        total = inputs.length;
        correct = 0.0;
        for(var i in inputs)
        {
            var output = eval(functionName+'(inputs[i])');
            console.log(output);
            console.log(outputs[i]);
            if(output == outputs[i])
            {
                correct += 1.0;
            }
        }
        message = 'Percent Correct = ' + (100*correct/total).toString();
        console.log(message);
    });
  
/*
var findMax = function(numbArray)
    {
        var max = numbArray[0];
        for (var i = 0; i < numbArray.length; i++)
        {
            if (numbArray[i] > max) max = numbArray[i];
        }
        return max;
    }
*/
</script>